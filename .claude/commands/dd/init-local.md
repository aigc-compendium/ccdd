---
allowed-tools: Task, Read, Write, Edit, Bash
---

# Init Local

为现有项目初始化 DD 工作流系统，通过深度分析和用户沟通建立完整的项目管理体系。

## Usage

```bash
/dd:init-local
```

## Instructions

### 1. 项目快速扫描

执行自动项目扫描获取基础信息：

```bash
bash .claude/scripts/dd/query/project-scan.sh
```

**扫描内容**: 文件结构 | 技术栈识别 | 配置文件 | Git 历史 | 潜在问题

### 2. 使用 deep-thinker 智能体深度挖掘

进行深度业务和技术理解：

#### 项目背景深挖
- **项目起源**: 为什么做这个项目？解决什么问题？
- **发展历程**: 经历了哪些重要的技术决策和变更？
- **当前痛点**: 现在面临的主要技术和业务挑战？
- **团队情况**: 技术栈熟悉度、开发规模、协作方式

#### 技术架构深度分析
- **架构演进**: 从最初设计到现在经历了什么变化？
- **技术债务**: 哪些地方需要重构？哪些设计不合理？
- **性能瓶颈**: 系统的性能热点和优化空间在哪里？
- **扩展性评估**: 未来扩展的主要方向和技术挑战

#### 业务逻辑挖掘
- **核心功能**: 最重要的 3-5 个核心功能模块
- **用户场景**: 主要的用户使用场景和业务流程
- **数据流**: 重要的数据处理和存储逻辑
- **集成关系**: 与外部系统的集成点和依赖关系

#### 发展规划讨论
- **短期目标**: 近期要解决的技术和功能问题
- **中期规划**: 6 个月内的主要发展方向
- **长期愿景**: 项目的终极目标和技术愿景
- **优先级评估**: 各种改进和新功能的优先级排序

### 3. AI 主动质疑和深入讨论

AI 基于扫描结果和用户描述，主动提出质疑和建议：

#### 技术决策质疑
- **架构合理性**: "你们为什么选择 XXX 架构？有考虑过 YYY 方案吗？"
- **技术选型**: "这个技术栈在你们的场景下最优吗？有遇到什么限制？"
- **性能设计**: "现在的性能表现如何？有预见的瓶颈吗？"

#### 业务逻辑挑战
- **需求边界**: "这个功能的边界清晰吗？有没有需求蔓延的问题？"
- **用户价值**: "用户最喜欢哪些功能？哪些功能使用率很低？"
- **业务流程**: "现在的业务流程有什么不合理的地方？"

#### 发展方向探讨
- **技术演进**: "下一步的技术升级重点应该是什么？"
- **功能规划**: "用户最期待的新功能是什么？"
- **团队成长**: "团队在技术上需要什么支持和提升？"

### 4. 基于深度对话生成个性化内容

AI 基于充分的对话生成个性化项目内容：
- **项目描述内容** - 基于真实项目历史和现状的深度描述
- **技术栈详情** - 包含技术债务分析和演进建议的技术栈描述  
- **架构设计** - 现有架构的优劣分析和改进方向
- **需求文档** - 基于现有功能和用户反馈的需求整理
- **项目状态** - 真实的项目现状和下一步行动计划

### 5. 总结对话要点

使用内置脚本分析当前会话：

```bash
bash .claude/scripts/dd/utils/get-session.sh
```

**重点记录**: 
- 关键的技术决策背景和考量
- 重要的业务逻辑和用户需求
- 确定的改进方向和优先级
- 团队的技术现状和发展需求

### 6. 执行 after-init.sh 后处理脚本

```bash
bash .claude/scripts/dd/after-init.sh "$structured_data"
```

**structured_data 数据结构**:

```json
{
  "project_name": "项目名称",
  "project_type": "基于分析确定的项目类型",
  "tech_stack": "现有技术栈 + 改进建议",
  "architecture": "现有架构模式 + 演进方向", 
  "conversation": "深度对话的关键要点总结",
  "project_content": "基于现状的项目深度描述",
  "tech_content": "技术栈现状分析和改进建议",
  "architecture_content": "架构现状和演进规划",
  "requirements_content": "基于现有功能的需求整理",
  "status_content": "真实项目状态和行动计划"
}
```

### 7. 合并配置文件

调用 claude-md-merger 智能体，将 `.claude/CLAUDE.md` 合并到根目录 `CLAUDE.md`

## 上下文文档生成格式要求

所有上下文文档必须遵循统一的格式结构：

### .claude/context/project.md 格式
```yaml
---
name: 项目名称
type: 项目类型
status: 当前状态
---

# 项目标题
## 项目背景
## 核心功能  
## 技术特点
## 项目现状
## 下一步计划
```

### .claude/context/tech-stack.md 格式
```yaml
---
# 技术栈分析
## 现有技术栈
## 架构模式
## 技术债务
## 改进建议
## 工具链现状
```

### .claude/context/architecture.md 格式
```yaml
---
architecture: 架构模式
---

# 项目架构分析
## 现有架构
## 架构优势
## 架构问题
## 演进方向
## 关键决策
```

### .claude/context/requirements.md 格式
```yaml
---
type: 项目类型
---

# 项目需求分析
## 现有功能
## 用户场景
## 功能需求
## 非功能需求
## 改进需求
## 新功能规划
```

### .claude/context/current-status.md 格式
```yaml
---
phase: 基于现有项目的当前阶段
progress: 百分比
---

# 当前项目状态
## 项目现状
## 已完成功能
## 进行中的工作
## 待解决问题
## 下一步行动
```

### 8. 完成提示

显示初始化成功信息和下一步建议：

```
✅ DD 现有项目初始化完成！

📁 生成文件:
   • .claude/chats/init-local/comm-{timestamp}.md - 深度分析对话记录
   • .claude/context/*.md - 基于现状的项目上下文文件
   • CLAUDE.md - 合并配置文件

🎯 分析成果:
   • 项目深度理解和现状分析
   • 技术债务识别和改进建议  
   • 业务逻辑梳理和需求整理
   • 明确的发展方向和行动计划

🚀 建议下一步:
   /dd:chat        - 深入讨论具体改进方案
   /dd:feature-add - 添加新功能需求
   /dd:code-reflect - 代码质量分析
```

## Important Notes

现有项目初始化重点是深度理解项目历史和现状，识别改进机会。
必须通过充分的用户沟通挖掘隐性知识和业务逻辑。
基于真实现状生成个性化内容，而非简单的技术扫描结果。
中英文间距规范：英文单词与中文字符间必须有空格。