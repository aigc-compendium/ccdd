---
allowed-tools: Task, Write, Read
---

# Feature Decompose

深度分析功能技术实现路径，按合理性进行议题规划和分解。

## Usage

```bash
/dd:feature-decompose <功能名称>
```

## Instructions

### 1. 功能信息收集

通过脚本收集分解所需的全部信息：

- **功能信息** - 直接读取 `.claude/features/<功能名称>/overview.md` 等文件
- **技术方案** - 直接读取 `.claude/features/<功能名称>/technical.md` 文件

### 2. 使用 feature-designer 智能体

调用专门的功能设计智能体进行深度分析：
- 深度理解功能需求和技术方案
- 智能分析技术实现路径
- 生成合理的议题分解方案
- 确保分解粒度和依赖关系的合理性

### 3. 智能体深度分析

基于收集的信息进行深度分析：

- **技术路径分析** - 分析最佳实现路径和关键技术点
- **依赖关系梳理** - 识别议题间和功能间的依赖关系
- **议题规划策略** - 制定合理的议题分解和执行计划
- **实现逻辑优化** - 确保议题分解的逻辑合理性

### 4. 智能议题分解

生成优化的议题列表：

- 基于技术复杂度建议议题数量（简单: 3-5 个，中等: 5-8 个，复杂: 8-12 个）
- 按实现顺序合理性排列议题
- 确定议题间的依赖关系
- 估算各议题工作量

### 5. 分解原则应用

**文档生成规范**
所有生成的议题文档内容必须遵循以下格式规范：

- **中英文混合文本**：英文单词与中文字符之间必须有一个空格
- **示例**：`这是一个 API 接口设计` 而不是 `这是一个API接口设计`
- **列表项格式**：所有列表项必须分行显示，每行以 "- " 开头
- **正确示例**：
  ```json
  {
    "implementation_points": "- 设计数据库表结构\n- 实现数据验证规则\n- 创建数据库索引",
    "todos": "- 分析功能数据需求\n- 创建数据库迁移脚本\n- 实现功能验证"
  }
  ```
- **错误示例**：`"todos": "分析需求|创建脚本|实现功能"`
- **适用范围**：所有议题描述、实现要点、验收标准、todo列表等

**议题独立性**
- 每个议题可以独立开发和验证
- 明确的输入和输出定义
- 清晰的验收标准

**合理的议题粒度**
- 单个议题功能完整独立
- 避免过度拆分或合并
- 便于进度跟踪和管理

**依赖关系清晰**
- 识别议题间的前后依赖
- 避免循环依赖
- 支持并行开发的议题

### 6. 智能议题文档生成

基于深度分析结果，为每个分解的议题调用生成脚本：

```bash
bash .claude/scripts/dd/generator/generate-issue.sh "<功能名称>" "<议题ID>" '<议题数据JSON>'
```

**参数说明**：

- `<功能名称>`: 功能名称
- `<议题ID>`: 议题 ID（如：001, 002, 003）
- `<议题数据JSON>`: 议题数据的 JSON 格式

**JSON 数据结构**：

```json
{
  "name": "议题名称",
  "goal": "议题目标描述",
  "implementation_points": "关键实现要点（markdown列表格式）",
  "acceptance_criteria": "验收条件（markdown列表格式）"
}
```

### 7. 更新功能文档议题清单

分解完成后，自动更新 `.claude/features/<功能名称>/overview.md` 中的 `## issues` 部分：

```bash
# 扫描生成的议题文件，获取议题列表
echo "=== 更新功能议题清单 ==="
for issue_file in .claude/features/<功能名称>/issues/*.md; do
    issue_id=$(basename "$issue_file" .md)
    issue_name=$(grep "^name:" "$issue_file" | cut -d: -f2- | xargs)
    echo "议题 $issue_id: $issue_name"
done

# AI 基于扫描结果，智能更新 overview.md 的 ## issues 部分
# 确保格式为:
# ## issues
# - 001
# - 002
# - 003
```

### 8. 输出结果生成

在功能目录下创建 `issues/` 文件夹：

```
.claude/features/{功能名}/issues/
├── 001.md  # 第一个议题
├── 002.md  # 第二个议题
└── ...
```

每个议题文件包含：

- YAML 元数据（议题名、功能名、状态）
- 议题描述和目标
- 实现要点
- 验收标准

### 9. 脚本调用序列

命令执行时按顺序调用以下脚本：

```bash
# 1. 收集功能信息
# 直接读取功能文档文件：overview.md, technical.md, acceptance.md

# 2. 生成议题文档（智能体分解后为每个议题调用）
bash .claude/scripts/dd/generator/generate-issue.sh "<功能名称>" "001" '<议题1_json>'
bash .claude/scripts/dd/generator/generate-issue.sh "<功能名称>" "002" '<议题2_json>'
bash .claude/scripts/dd/generator/generate-issue.sh "<功能名称>" "003" '<议题3_json>'
# ... 为每个议题调用一次

# 3. 完成验证和总结
# 智能体直接输出分解结果摘要，无需脚本
```

### 10. 完成处理

智能体输出分解结果摘要和下一步建议：

```
🎯 功能议题分解完成！
📋 功能: {功能名}
📊 已生成 {X} 个议题
⏱️ 预估总工时: {Y} 小时

📝 建议下一步操作:
   /dd:feature-start {功能名}  - 开始功能开发

💡 或查看议题详情:
   查看 .claude/features/{功能名}/issues/ 目录
```

### 11. 质量标准验证

- **独立性** - 议题可独立完成和验证
- **完整性** - 覆盖功能所有技术要求
- **合理性** - 议题大小和复杂度适中
- **可验证性** - 明确的验收和完成标准

## Important Notes

智能分解功能为具体议题，基于技术实现路径分析。
按依赖关系排序议题，生成详细议题文档。
专注功能实现逻辑，确保议题分解的合理性。
使用 feature-designer 智能体确保分解质量。