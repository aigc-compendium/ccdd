---
allowed-tools: Task, Read, Write, Edit, Bash, Glob, Grep
---

# DD 已有项目初始化

为已有项目初始化 CCDD Helper 系统, 分析现有架构并建立管理体系.

## 功能概述

深度分析现有项目并生成对话记录:

- 快速扫描项目结构和技术栈
- 与用户深度探讨项目现状和规划
- 记录完整对话历史到 `.claude/chats/init/`
- 建立项目上下文和开发规划

## 执行流程

### 1. 项目快速扫描

执行快速项目扫描, 获取项目概览信息:

```bash
bash .claude/scripts/dd/query/project-scan.sh
```

扫描内容包括:

- 项目基本信息（文件数量、目录结构）
- 技术栈自动识别（Node.js、Python、Go、Rust、Java 等）
- 主要配置文件列表
- 代码文件统计
- Git 仓库状态
- 潜在问题提醒

**优势**: 相比智能体分析, 扫描速度快 10-20 倍, 信息覆盖全面

### 2. 深度探讨和确认

基于项目扫描结果, AI 重点探讨以下**核心技术关键点**（避免重复性问题）:

**必须明确的技术关键点**:

1. **架构现状**: 当前架构模式是否需要优化？有哪些技术债务？
2. **技术栈评估**: 现有技术选择是否合理？是否需要升级或替换？
3. **核心业务边界**: 项目的核心功能范围和边界在哪里？
4. **扩展规划**: 未来 6 个月内计划添加哪些核心功能？

**智能跳过的常规问题**:

- 团队规模、开发经验等基础信息
- 部署环境、运维方式等标准流程
- 通用的编码规范和测试策略

**💬 重要**: 只讨论技术关键决策点, 避免基础问题, 确认关键信息后继续

**📋 开发决策模式**:

- **默认自动模式**: AI 基于分析自动生成技术方案和架构建议

### 3. 建立项目上下文

基于分析结果生成:

- 项目现状描述
- 架构优化建议
- 技术栈整理
- 改进行动计划

### 4. 执行 after-init.sh

执行后处理脚本, 传递完整的对话数据:

```bash
# 构建包含对话历史的 JSON 数据
conversation_data=$(cat << 'EOF'
{
  "project_name": "从扫描结果提取的项目名称",
  "project_type": "从技术栈推断的项目类型",
  "tech_stack": "识别到的技术栈",
  "architecture": "从代码结构分析的架构模式",
  "conversation": "完整的真实对话历史, 逐句记录: \n\n[项目扫描结果展示]\n---\n用户: 这个扫描结果看起来不错\n---\n助手: 我看到您的项目使用了Rust技术栈...\n---\n用户: 是的, 我们主要关注性能\n---\n助手: 针对性能优化, 我建议...\n---\n\n[记录所有实际对话内容, 每轮对话用---分割, 不是总结]"
}
EOF
)

bash .claude/scripts/dd/after-init.sh "$conversation_data"
```

**重要**: 必须记录完整的真实对话历史:

- 不是总结, 是逐句的实际对话内容
- 包括项目扫描结果的完整展示
- 包括用户对扫描结果的反应和问题
- 包括 AI 的分析建议和用户的确认
- 保持对话的原始格式和完整性

### 5. 智能合并 CLAUDE.md 配置

**必须执行**: 调用 claude-md-merger 智能体, 让 AI 自动将 `.claude/CLAUDE.md` 合并到根目录的 `CLAUDE.md`.

## 完成后提示

```
✅ 已有项目初始化完成！
📝 已生成文件:
   • .claude/chats/init/comm-{timestamp}.md - 对话记录
   • .claude/context/project.md - 项目基础信息
   • .claude/context/tech-stack.md - 技术栈信息
   • .claude/context/architecture.md - 架构设计
   • CLAUDE.md - 智能合并的配置文件

📝 建议下一步操作:
   /dd:chat        - 基于项目上下文的深度咨询
   /dd:feature-add - 添加第一个核心功能
   /dd:status      - 查看项目整体状态
```

## 文档生成规范

### 中英文间距要求

所有生成的文档内容必须遵循以下格式规范：

- **中英文混合文本**：英文单词与中文字符之间必须有一个空格
- **示例**：`这是一个 Node.js 项目` 而不是 `这是一个Node.js项目`
- **适用范围**：所有项目分析、技术评估、架构说明等
- **特殊情况**：标点符号前后不需要额外空格

## 深度思考要点

- **现状评估** - 客观分析项目当前状态和问题
- **用户需求确认** - 确保理解用户的真实意图和期望
- **技术决策** - 重构 vs 渐进改进的策略选择
- **风险识别** - 识别技术债务和潜在风险点
- **价值优先级** - 平衡技术完美与业务价值交付
- **团队现实** - 考虑团队技术栈熟悉度和学习成本
