---
allowed-tools: Read, Edit, LS, Task
---

# å®Œæˆä»»åŠ¡

æ ‡è®°ä»»åŠ¡ä¸ºå·²å®Œæˆï¼Œè¿›è¡ŒéªŒæ”¶æ£€æŸ¥ï¼Œå¹¶è§¦å‘ç›¸å…³çš„åç»­æµç¨‹ã€‚

## ç”¨æ³•
```
/dd:task-finish <ä»»åŠ¡ID>
```

## å‚æ•°è¯´æ˜
- `<ä»»åŠ¡ID>` - è¦å®Œæˆçš„ä»»åŠ¡æ ‡è¯†ç¬¦

## æ“ä½œæŒ‡å—

### 1. ä»»åŠ¡çŠ¶æ€éªŒè¯
```bash
# æŸ¥æ‰¾ä»»åŠ¡æ–‡ä»¶
task_file=$(find .claude/epics -name "${ARGUMENTS}.md" | head -1)

if [ ! -f "$task_file" ]; then
  echo "âŒ ä»»åŠ¡ä¸å­˜åœ¨ï¼š$ARGUMENTS"
  echo "ğŸ’¡ è¿è¡Œ /dd:task-list æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡"
  exit 1
fi

# æ£€æŸ¥å½“å‰çŠ¶æ€
current_status=$(grep "^çŠ¶æ€:" "$task_file" | sed 's/^çŠ¶æ€: *//')

if [ "$current_status" == "å·²å®Œæˆ" ]; then
  echo "â„¹ï¸ ä»»åŠ¡å·²ç»å®Œæˆ"
  exit 0
elif [ "$current_status" != "è¿›è¡Œä¸­" ] && [ "$current_status" != "å·²æš‚åœ" ]; then
  echo "âš ï¸ ä»»åŠ¡å½“å‰çŠ¶æ€ä¸ºï¼š$current_status"
  echo "ğŸ’¡ åªæœ‰è¿›è¡Œä¸­æˆ–å·²æš‚åœçš„ä»»åŠ¡æ‰èƒ½æ ‡è®°å®Œæˆ"
  exit 1
fi
```

### 2. éªŒæ”¶æ ‡å‡†æ£€æŸ¥
```bash
# ä½¿ç”¨ä»£ç åˆ†ææ™ºèƒ½ä½“è¿›è¡ŒéªŒæ”¶æ£€æŸ¥
perform_acceptance_check() {
  local task_file="$1"
  local task_name=$(grep "^åç§°:" "$task_file" | sed 's/^åç§°: *//')
  
  # æå–éªŒæ”¶æ ‡å‡†
  local acceptance_criteria=$(sed -n '/^## éªŒæ”¶æ ‡å‡†/,/^## /p' "$task_file" | grep "^- \[ \]")
  
  if [ -n "$acceptance_criteria" ]; then
    echo "ğŸ“‹ æ­£åœ¨æ£€æŸ¥éªŒæ”¶æ ‡å‡†..."
    echo "$acceptance_criteria"
    echo ""
    echo "âš ï¸ è¯·ç¡®è®¤æ‰€æœ‰éªŒæ”¶æ ‡å‡†æ˜¯å¦å·²æ»¡è¶³"
    echo "ğŸ’¡ å¦‚æœ‰æœªå®Œæˆé¡¹ï¼Œè¯·å…ˆå®Œæˆåå†æ ‡è®°ä»»åŠ¡å®Œæˆ"
  fi
}
```

### 3. ä»£ç æ”¹åŠ¨éªŒè¯
```yaml
Task:
  description: "éªŒè¯ä»»åŠ¡å®Œæˆè´¨é‡"
  subagent_type: "code-analyzer"
  prompt: |
    éªŒè¯ä»»åŠ¡å®Œæˆçš„ä»£ç æ”¹åŠ¨è´¨é‡ï¼š
    
    å½“å‰ä»»åŠ¡ï¼š{ä»»åŠ¡åç§°}
    ä»»åŠ¡IDï¼š{ä»»åŠ¡ID}
    
    è¯·åˆ†æï¼š
    1. ä»£ç æ”¹åŠ¨æ˜¯å¦ç¬¦åˆä»»åŠ¡ç›®æ ‡
    2. å®ç°æ˜¯å¦å®Œæ•´å’Œæ­£ç¡®
    3. æ˜¯å¦éµå¾ªäº†ä»£ç è§„èŒƒ
    4. æ˜¯å¦æœ‰æ½œåœ¨çš„bugæˆ–é—®é¢˜
    5. æ˜¯å¦éœ€è¦è¡¥å……æ–‡æ¡£æˆ–æµ‹è¯•
    
    ä»»åŠ¡éªŒæ”¶æ ‡å‡†ï¼š
    {ä»ä»»åŠ¡æ–‡ä»¶æå–çš„éªŒæ”¶æ ‡å‡†}
    
    åŸºäºåˆ†æç»“æœï¼Œæä¾›ï¼š
    - ä»»åŠ¡å®Œæˆè´¨é‡è¯„ä¼°ï¼ˆ1-10åˆ†ï¼‰
    - å‘ç°çš„é—®é¢˜å’Œæ”¹è¿›å»ºè®®
    - æ˜¯å¦å»ºè®®æ ‡è®°ä¸ºå®Œæˆ
```

### 4. æ›´æ–°ä»»åŠ¡çŠ¶æ€
```bash
# æ ‡è®°ä»»åŠ¡å®Œæˆ
complete_task() {
  local task_file="$1"
  local current_time=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
  
  # æ›´æ–°ä»»åŠ¡çŠ¶æ€
  sed -i.bak "s/^çŠ¶æ€:.*/çŠ¶æ€: å·²å®Œæˆ/" "$task_file"
  sed -i.bak "s/^æœ€åæ›´æ–°:.*/æœ€åæ›´æ–°: $current_time/" "$task_file"
  
  # æ·»åŠ å®Œæˆæ—¶é—´
  if ! grep -q "^å®Œæˆæ—¶é—´:" "$task_file"; then
    sed -i.bak "/^æœ€åæ›´æ–°:/a\\
å®Œæˆæ—¶é—´: $current_time" "$task_file"
  else
    sed -i.bak "s/^å®Œæˆæ—¶é—´:.*/å®Œæˆæ—¶é—´: $current_time/" "$task_file"
  fi
  
  # æ¸…ç†æš‚åœæ—¶é—´ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
  sed -i.bak "/^æš‚åœæ—¶é—´:/d" "$task_file"
  
  rm "${task_file}.bak"
}
```

### 5. è‡ªåŠ¨è§¦å‘åæ€
```bash
# ä»»åŠ¡å®Œæˆåè‡ªåŠ¨è¿›è¡Œåæ€
auto_reflect_on_completion() {
  echo "ğŸ¤” ä»»åŠ¡å®Œæˆï¼Œè‡ªåŠ¨å¼€å§‹åæ€åˆ†æ..."
  
  # è°ƒç”¨åæ€å‘½ä»¤
  /dd:code-reflect
  
  # å°†åæ€ç»“æœé™„åŠ åˆ°ä»»åŠ¡è®°å½•
  if [ -f "/tmp/reflection-summary.md" ]; then
    cat >> "$task_file" << EOF

## å®Œæˆåæ€
$(cat /tmp/reflection-summary.md)
EOF
  fi
}
```

### 6. è§£é”ä¾èµ–ä»»åŠ¡
```bash
# åˆ†æä»»åŠ¡å®Œæˆå¯¹å…¶ä»–ä»»åŠ¡çš„å½±å“
unlock_dependent_tasks() {
  local task_id="$1"
  
  # æŸ¥æ‰¾ä¾èµ–æ­¤ä»»åŠ¡çš„å…¶ä»–ä»»åŠ¡
  local dependent_tasks=$(find .claude/epics -name "*.md" -exec grep -l "ä¾èµ–:.*$task_id" {} \;)
  
  if [ -n "$dependent_tasks" ]; then
    echo ""
    echo "ğŸ‰ ä»»åŠ¡å®Œæˆå½±å“åˆ†æï¼š"
    echo "ä»¥ä¸‹ä»»åŠ¡çš„ä¾èµ–æ¡ä»¶ç°å·²æ»¡è¶³ï¼š"
    
    local unlocked_count=0
    
    echo "$dependent_tasks" | while read dep_file; do
      local dep_task_id=$(basename "$dep_file" .md)
      local dep_task_name=$(grep "^åç§°:" "$dep_file" | sed 's/^åç§°: *//')
      local dep_task_status=$(grep "^çŠ¶æ€:" "$dep_file" | sed 's/^çŠ¶æ€: *//')
      
      # æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ä¾èµ–éƒ½å·²å®Œæˆ
      local all_deps_complete=true
      local task_deps=$(grep "^ä¾èµ–:" "$dep_file" | sed 's/^ä¾èµ–: *\[//; s/\]//' | tr ',' ' ')
      
      for dep in $task_deps; do
        dep=$(echo "$dep" | xargs)
        local dep_status=$(find .claude/epics -name "$dep.md" -exec grep "^çŠ¶æ€:" {} \; | sed 's/^çŠ¶æ€: *//')
        if [ "$dep_status" != "å·²å®Œæˆ" ]; then
          all_deps_complete=false
          break
        fi
      done
      
      if [ "$all_deps_complete" == "true" ] && [ "$dep_task_status" == "å¾…å¼€å§‹" ]; then
        echo "  âœ… $dep_task_name ($dep_task_id) - å¯ç«‹å³å¼€å§‹"
        echo "     ğŸ’¡ è¿è¡Œï¼š/dd:task-start $dep_task_id"
        ((unlocked_count++))
      else
        echo "  â³ $dep_task_name ($dep_task_id) - ä»æœ‰å…¶ä»–ä¾èµ–æˆ–å·²åœ¨è¿›è¡Œ"
      fi
    done
    
    if [ $unlocked_count -gt 0 ]; then
      echo ""
      echo "ğŸš€ å·²è§£é” $unlocked_count ä¸ªä»»åŠ¡ï¼Œå¯ä»¥ç»§ç»­æ¨è¿›é¡¹ç›®è¿›åº¦ï¼"
    fi
  fi
}
```

### 7. æ¸…ç†ä»»åŠ¡ä¸Šä¸‹æ–‡
```bash
# æ¸…ç†å½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡
cleanup_task_context() {
  local task_id="$1"
  
  # å½’æ¡£å½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡
  if [ -f ".claude/context/current-task.md" ]; then
    local archive_file=".claude/context/task-history/$(date +%Y%m%d-%H%M%S)-task-completed.md"
    mkdir -p ".claude/context/task-history"
    mv ".claude/context/current-task.md" "$archive_file"
    echo "ğŸ“š ä»»åŠ¡æ‰§è¡Œè®°å½•å·²å½’æ¡£åˆ°ï¼š$archive_file"
  fi
  
  # æ¸…ç†æš‚åœä¸Šä¸‹æ–‡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
  local pause_context=".claude/context/paused-task-${task_id}.md"
  if [ -f "$pause_context" ]; then
    rm "$pause_context"
    echo "ğŸ§¹ å·²æ¸…ç†ä»»åŠ¡æš‚åœä¸Šä¸‹æ–‡"
  fi
}
```

## è¾“å‡ºæ ¼å¼

### å®ŒæˆæˆåŠŸ
```markdown
ğŸ‰ ä»»åŠ¡å®Œæˆï¼

ğŸ“‹ ä»»åŠ¡ä¿¡æ¯ï¼š
  - ä»»åŠ¡IDï¼š{ä»»åŠ¡ID}
  - ä»»åŠ¡åç§°ï¼š{ä»»åŠ¡åç§°}
  - å®Œæˆæ—¶é—´ï¼š{å®Œæˆæ—¶é—´}
  - æ‰§è¡Œæ—¶é•¿ï¼š{æ€»æ‰§è¡Œæ—¶é—´}

âœ… éªŒæ”¶çŠ¶æ€ï¼š
  - ä»£ç è´¨é‡ï¼š{è´¨é‡è¯„åˆ†}/10
  - éªŒæ”¶æ ‡å‡†ï¼š{æ»¡è¶³/éƒ¨åˆ†æ»¡è¶³/æœªæ»¡è¶³}
  - æ¨èçŠ¶æ€ï¼š{å»ºè®®å®Œæˆ/éœ€è¦æ”¹è¿›}

ğŸ¯ ä»»åŠ¡æˆæœï¼š
  - å®ç°ç›®æ ‡ï¼š{è¾¾æˆæƒ…å†µ}
  - äº¤ä»˜ç‰©ï¼š{å…·ä½“äº§å‡º}
  - å½±å“èŒƒå›´ï¼š{å—å½±å“çš„ç»„ä»¶æˆ–åŠŸèƒ½}

ğŸ”“ è§£é”ä»»åŠ¡ï¼š
  - è§£é”ä»»åŠ¡æ•°ï¼š{æ•°é‡}
  - å¯å¼€å§‹ä»»åŠ¡ï¼š{ä»»åŠ¡åˆ—è¡¨}
  - ä¸‹ä¸€æ­¥å»ºè®®ï¼š{å…·ä½“è¡ŒåŠ¨å»ºè®®}

ğŸ¤” å®Œæˆåæ€ï¼š
  {è‡ªåŠ¨åæ€åˆ†æç»“æœæ‘˜è¦}
```

## é”™è¯¯å¤„ç†

### ä»»åŠ¡çŠ¶æ€é”™è¯¯
```markdown
âš ï¸ æ— æ³•å®Œæˆä»»åŠ¡

ä»»åŠ¡çŠ¶æ€ï¼š{å½“å‰çŠ¶æ€}
å®Œæˆæ¡ä»¶ï¼šåªæœ‰"è¿›è¡Œä¸­"æˆ–"å·²æš‚åœ"çš„ä»»åŠ¡æ‰èƒ½æ ‡è®°å®Œæˆ

å»ºè®®æ“ä½œï¼š
- å¦‚æœä»»åŠ¡æ˜¯"å¾…å¼€å§‹"ï¼Œè¯·å…ˆä½¿ç”¨ /dd:task-start {ä»»åŠ¡ID}
- å¦‚æœä»»åŠ¡æ˜¯"å·²å®Œæˆ"ï¼Œä»»åŠ¡å·²ç»å®Œæˆ
```

### éªŒæ”¶æ ‡å‡†æœªæ»¡è¶³
```markdown
âš ï¸ éªŒæ”¶æ ‡å‡†æ£€æŸ¥

å‘ç°é—®é¢˜ï¼š
- éªŒæ”¶æ ‡å‡†1ï¼šæœªæ»¡è¶³
- éªŒæ”¶æ ‡å‡†2ï¼šéƒ¨åˆ†æ»¡è¶³
- ä»£ç è´¨é‡è¯„åˆ†ï¼š{åˆ†æ•°}/10

å»ºè®®æ“ä½œï¼š
1. å®Œæˆå‰©ä½™çš„éªŒæ”¶æ ‡å‡†
2. è§£å†³å‘ç°çš„ä»£ç é—®é¢˜
3. é‡æ–°è¿è¡Œ /dd:task-finish {ä»»åŠ¡ID}

æˆ–è€…ï¼š
- å¼ºåˆ¶å®Œæˆï¼šç¡®è®¤é—®é¢˜å¯æ¥å—åå†æ¬¡è¿è¡Œå‘½ä»¤
```

## æœ€ä½³å®è·µ

### å®Œæˆå‰æ£€æŸ¥
1. **éªŒæ”¶æ ‡å‡†** - ç¡®ä¿æ‰€æœ‰éªŒæ”¶æ ‡å‡†éƒ½å·²æ»¡è¶³
2. **ä»£ç è´¨é‡** - è¿›è¡Œä»£ç å®¡æŸ¥å’Œè´¨é‡æ£€æŸ¥
3. **æ–‡æ¡£æ›´æ–°** - ç¡®ä¿ç›¸å…³æ–‡æ¡£å·²æ›´æ–°
4. **æµ‹è¯•è¦†ç›–** - éªŒè¯åŠŸèƒ½æµ‹è¯•é€šè¿‡

### å®Œæˆåæ“ä½œ
1. **åæ€æ€»ç»“** - è®°å½•ç»éªŒæ•™è®­å’Œæ”¹è¿›ç‚¹
2. **çŸ¥è¯†åˆ†äº«** - ä¸å›¢é˜Ÿåˆ†äº«å®æ–½ç»éªŒ
3. **åç»­è§„åˆ’** - å®‰æ’åç»­ä»»åŠ¡çš„æ‰§è¡Œ
4. **æŒç»­æ”¹è¿›** - åŸºäºåæ€ç»“æœæ”¹è¿›æµç¨‹

## ä½¿ç”¨ç¤ºä¾‹

```bash
# å®Œæˆå½“å‰ä»»åŠ¡
/dd:task-finish 001

# å®Œæˆç‰¹å®šä»»åŠ¡
/dd:task-finish user-auth-api
```