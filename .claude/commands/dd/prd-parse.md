---
allowed-tools: Read, Write, LS
---

# 解析 PRD 为技术实施计划

将产品需求文档转换为技术实施计划。

## 用法
```
/dd:prd-parse <功能名称>
```

## 必要规则

**重要：** 执行此命令前，请阅读并遵循：
- `.claude/rules/datetime.md` - 获取真实的当前日期时间

## 预检清单

执行前完成这些验证步骤。
不要打扰用户预检进度（"我不会..."），直接执行并继续。

### 验证步骤
1. **验证 <功能名称> 作为参数提供：**
   - 如果没有，告诉用户："❌ 未提供 <功能名称> 参数。请运行：/dd:prd-parse <功能名称>"
   - 如果未提供 <功能名称>，停止执行

2. **验证 PRD 存在：**
   - 检查 `.claude/prds/$ARGUMENTS.md` 是否存在
   - 如果未找到，告诉用户："❌ 未找到 PRD：$ARGUMENTS。请先创建：/dd:prd-new $ARGUMENTS"
   - 如果 PRD 不存在，停止执行

3. **验证 PRD 前置元数据：**
   - 验证 PRD 具有有效的前置元数据：名称、描述、状态、创建时间
   - 如果前置元数据无效或缺失，告诉用户："❌ PRD 前置元数据无效。请检查：.claude/prds/$ARGUMENTS.md"
   - 显示缺失或无效的内容

4. **检查现有执行计划：**
   - 检查 `.claude/epics/$ARGUMENTS/epic.md` 是否已存在
   - 如果存在，询问用户："⚠️ 执行计划 '$ARGUMENTS' 已存在。覆盖？(是/否)"
   - 只有明确确认 '是' 才继续
   - 如果用户说否，建议："查看现有执行计划：/dd:epic-show $ARGUMENTS"

5. **验证目录权限：**
   - 确保 `.claude/epics/` 目录存在或可以创建
   - 如果无法创建，告诉用户："❌ 无法创建执行计划目录。请检查权限。"

## 操作指南

你是一位技术负责人，正在将产品需求文档转换为功能 **$ARGUMENTS** 的详细实施计划。

### 1. 读取 PRD
- 从 `.claude/prds/$ARGUMENTS.md` 加载 PRD
- 分析所有需求和约束
- 了解用户故事和成功标准
- 从前置元数据中提取 PRD 描述

### 2. 技术分析
- 识别需要的架构决策
- 确定技术栈和方法
- 将功能需求映射到技术组件
- 识别集成点和依赖关系

### 3. 带前置元数据的文件格式
在以下位置创建执行计划文件：`.claude/epics/$ARGUMENTS/epic.md`，使用以下确切结构：

```markdown
---
名称: $ARGUMENTS
状态: backlog
创建时间: [当前 ISO 日期时间]
进度: 0%
来源: .claude/prds/$ARGUMENTS.md
---

# 执行计划: $ARGUMENTS

## 概述
实施方法的简要技术摘要

## 架构决策
- 关键技术决策和理由
- 技术选择
- 使用的设计模式

## 技术方案
### 前端组件
- 需要的 UI 组件
- 状态管理方法
- 用户交互模式

### 后端服务
- 所需的 API 端点
- 数据模型和架构
- 业务逻辑组件

### 基础设施
- 部署考虑
- 扩展需求
- 监控和可观测性

## 实施策略
- 开发阶段
- 风险缓解
- 测试方法

## 任务分解预览
将创建的高级任务类别：
- [ ] 类别1：描述
- [ ] 类别2：描述
- [ ] 等等

## 依赖关系
- 外部服务依赖
- 内部团队依赖
- 前置工作

## 成功标准（技术）
- 性能基准
- 质量关卡
- 验收标准

## 工作量估计
- 整体时间线估计
- 资源需求
- 关键路径项目
```

### 4. 前置元数据指南
- **名称**：使用确切的功能名称（与 $ARGUMENTS 相同）
- **状态**：新执行计划始终以 "backlog" 开始
- **创建时间**：运行以下命令获取真实当前日期时间：`date -u +"%Y-%m-%dT%H:%M:%SZ"`
- **进度**：新执行计划始终以 "0%" 开始
- **来源**：引用源 PRD 文件路径

### 5. 输出位置
如果不存在，创建目录结构：
- `.claude/epics/$ARGUMENTS/`（目录）
- `.claude/epics/$ARGUMENTS/epic.md`（执行计划文件）

### 6. 质量验证

保存执行计划之前，验证：
- [ ] 所有 PRD 需求在技术方案中得到解决
- [ ] 任务分解类别涵盖所有实施领域
- [ ] 依赖关系技术上准确
- [ ] 工作量估计现实可行
- [ ] 架构决策有依据

### 7. 创建后

成功创建执行计划后：
1. 确认："✅ 执行计划已创建：.claude/epics/$ARGUMENTS/epic.md"
2. 显示摘要：
   - 识别的任务类别数量
   - 关键架构决策
   - 估计工作量
3. 建议下一步："准备分解为任务？运行：/dd:epic-decompose $ARGUMENTS"

## 错误恢复

如果任何步骤失败：
- 清楚解释出了什么问题
- 如果 PRD 不完整，列出具体缺失部分
- 如果技术方案不清楚，识别需要澄清的内容
- 永不创建信息不完整的执行计划

专注于创建技术合理的实施计划，解决所有 PRD 需求，同时对 "$ARGUMENTS" 实用可行。

## 重要提醒：
- 尽可能减少任务数量，将任务总数限制在10个或更少。
- 创建执行计划时，识别简化和改进的方法。寻找利用现有功能而非创建更多代码的方法。