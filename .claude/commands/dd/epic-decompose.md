---
allowed-tools: Read, Write, LS, Task
---

# 执行计划任务分解

将执行计划分解为具体的可执行任务。

## 用法
```
/dd:epic-decompose <功能名称>
```

## 必要规则

**重要：** 执行此命令前，请阅读并遵循：
- `.claude/rules/datetime.md` - 获取真实的当前日期时间

## 预检清单

执行前完成这些验证步骤。
不要打扰用户预检进度，直接执行并继续。

### 验证步骤
1. **验证执行计划存在：**
   - 检查 `.claude/epics/$ARGUMENTS/epic.md` 是否存在
   - 如果不存在，告诉用户："❌ 未找到执行计划：$ARGUMENTS。请先运行：/dd:prd-parse $ARGUMENTS"

2. **检查现有任务：**
   - 检查 `.claude/epics/$ARGUMENTS/` 目录中的现有任务文件
   - 如果存在任务文件，警告用户："⚠️ 任务已存在。这将覆盖现有任务文件。继续？(是/否)"
   - 只有明确确认才继续

3. **验证执行计划内容：**
   - 确保执行计划有完整的技术方案和任务预览
   - 如果内容不足，建议完善执行计划

## 操作指南

你是一位技术负责人，正在将执行计划分解为具体任务。

### 1. 分析执行计划
- 仔细阅读 `.claude/epics/$ARGUMENTS/epic.md`
- 理解技术方案和实施策略
- 识别关键组件和依赖关系
- 评估复杂度和风险

### 2. 任务设计原则
- **最少任务原则**：尽量减少任务数量，目标 ≤ 10 个任务
- **独立性**：每个任务应该能够独立完成和测试
- **并行性**：识别可以并行执行的任务
- **依赖管理**：明确任务间的依赖关系
- **可测试性**：每个任务都有清晰的完成标准

### 3. 任务分解策略

#### 按层次分解
- **基础设施任务**：数据库、配置、环境设置
- **后端任务**：API、服务、业务逻辑
- **前端任务**：界面、组件、用户交互
- **集成任务**：系统集成、端到端测试
- **部署任务**：部署脚本、监控设置

#### 按功能分解
- 将大功能拆分为小的子功能
- 每个子功能对应一个任务
- 确保每个任务提供独立价值

### 4. 任务文件格式

为每个任务创建文件：`.claude/epics/$ARGUMENTS/001.md`、`002.md` 等

```markdown
---
名称: 具体任务名称
状态: 待开始
创建时间: [当前 ISO 时间]
预估工作量: X小时
优先级: 高|中|低
并行: true|false
依赖: []
冲突: []
标签: [前端, 后端, 数据库]
---

# 任务：具体任务名称

## 目标
清晰描述此任务要实现什么

## 验收标准
- [ ] 标准1：具体可测试的条件
- [ ] 标准2：具体可测试的条件
- [ ] 标准3：具体可测试的条件

## 技术方案
### 实施步骤
1. 步骤1：详细描述
2. 步骤2：详细描述
3. 步骤3：详细描述

### 技术要点
- 关键技术考虑
- 性能要求
- 安全注意事项

## 文件变更
### 需要创建的文件
- `路径/文件名.ext`：文件用途说明

### 需要修改的文件  
- `路径/现有文件.ext`：修改内容说明

## 测试计划
- 单元测试要求
- 集成测试场景
- 手动测试步骤

## 风险和注意事项
- 潜在风险
- 缓解措施
- 需要特别注意的地方

## 相关资源
- 相关文档链接
- 技术参考资料
- 示例代码或设计
```

### 5. 依赖关系管理

#### 依赖字段说明
- `依赖: [001, 003]` - 必须在任务001和003完成后才能开始
- `冲突: [002, 005]` - 不能与任务002和005同时进行
- `并行: true` - 可以与其他并行任务同时进行

#### 依赖关系原则
- 尽量减少依赖关系
- 清晰标注必要的依赖
- 避免循环依赖
- 优化并行执行可能性

### 6. 使用智能体并行处理

如果任务数量较多（≥5个），使用 Task 工具并行创建：

```
Task:
  description: "创建任务批次 {X}"
  subagent_type: "general-purpose" 
  prompt: |
    为执行计划 $ARGUMENTS 创建任务文件
    
    需要创建的任务：
    - 任务1：描述
    - 任务2：描述  
    - 任务3：描述
    
    按照标准格式创建每个任务文件，确保：
    1. 完整的前置元数据
    2. 清晰的验收标准
    3. 详细的实施步骤
    4. 合理的依赖关系设置
```

### 7. 更新执行计划

任务创建完成后，更新执行计划文件：

#### 添加任务摘要部分
```markdown
## 任务分解完成

### 任务列表
- [ ] 001 - 任务名称1（并行: true）
- [ ] 002 - 任务名称2（并行: false）
- [ ] 003 - 任务名称3（并行: true）

### 统计信息
- 总任务数：X
- 可并行任务：Y
- 顺序任务：Z
- 预估总工作量：A小时

### 执行建议
- 建议优先级顺序
- 并行执行策略
- 风险控制要点
```

### 8. 输出

任务分解完成后：

```
✅ 执行计划任务分解完成: $ARGUMENTS

📋 任务创建：
  - 总任务数: {数量}
  - 可并行任务: {数量}  
  - 顺序任务: {数量}
  - 预估工作量: {小时数}小时

📁 文件创建：
  - 执行计划已更新
  - 任务文件: 001.md 到 {最后编号}.md

🚀 下一步：
  - 查看任务详情: /dd:epic-show $ARGUMENTS
  - 开始实施: 选择一个任务开始开发
  - 状态跟踪: /dd:status
```

## 质量标准

每个任务必须满足：
- [ ] 有明确的目标和验收标准
- [ ] 工作量估计合理（通常2-8小时）
- [ ] 依赖关系清晰标注
- [ ] 技术方案具体可行
- [ ] 测试要求明确定义

## 最佳实践

1. **保持任务原子性** - 每个任务应该是最小可交付单元
2. **优化并行度** - 最大化可并行执行的任务
3. **平衡粒度** - 避免任务过大或过小
4. **考虑测试** - 每个任务都要有测试计划
5. **文档完整** - 详细记录实施细节和决策依据