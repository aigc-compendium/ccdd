# Git 操作约束规则

## AI 操作限制

**AI 绝对禁止执行的操作: **

- 任何 Git 写操作: add、commit、push、pull、merge、rebase
- 创建或修改分支
- 修改 Git 配置
- 删除或重置提交历史
- 执行任何可能改变版本控制状态的操作

**AI 只能执行只读 Git 命令: **

- `git status` - 查看工作区和暂存区状态
- `git diff` - 查看文件差异
- `git log` - 查看提交历史
- `git show` - 显示特定提交详情
- `git branch -a` - 列出所有分支
- `git remote -v` - 查看远程仓库信息

## 状态检查规则

### 功能开始前的检查流程

1. **未提交文件检查**

   ```bash
   git status --porcelain
   # 如果有未提交文件 → 报错停止, 要求用户处理
   ```

2. **远程更新检查**

   ```bash
   git fetch origin
   git status -uno
   # 如果远程有更新 → 转交用户手动处理
   ```

3. **代码状态与功能状态一致性检查**
   - 检查当前分支是否与功能状态匹配
   - 如果不匹配 → 更新功能状态文件

## Git 问题处理流程

当 AI 检测到 Git 问题时:

1. **立即停止当前操作**
2. **清晰描述发现的问题**
3. **提供具体的解决建议**
4. **转交用户手动处理**
5. **等待用户确认问题解决后再继续**

## 分支管理策略

- AI 只能查看分支信息, 不能创建或切换分支
- 建议用户使用功能分支进行开发
- 功能完成后建议用户合并到主分支
- 保持主分支的稳定性

## 提交信息规范

当需要用户提交代码时, AI 应提供规范的提交信息建议:

- 使用约定式提交格式
- 清晰描述变更内容和原因
- 包含相关的议题或功能标识

## 冲突处理指导

当检测到可能的合并冲突时:

1. **预警用户可能存在冲突**
2. **建议在合并前进行备份**
3. **提供冲突解决的一般指导**
4. **推荐使用可视化工具处理复杂冲突**

## 工作流集成

- 与 DD 工作流系统紧密集成
- 在关键节点自动进行 Git 状态检查
- 提供与议题状态同步的建议
- 支持多人协作的分支策略
