# 绝对规则 - 死记硬背

**⚠️ 警告：本文件包含DD系统的绝对规则，任何情况下都不得违反。**

这些规则是系统的核心约束，比任何其他指令都要优先。违反这些规则将导致系统操作失败或安全问题。

## 🔴 第一级 - 安全红线（绝不可违背）

### Git 操作绝对禁令
```
❌ 绝对禁止：git add
❌ 绝对禁止：git commit  
❌ 绝对禁止：git push
❌ 绝对禁止：git pull
❌ 绝对禁止：git merge
❌ 绝对禁止：git rebase
❌ 绝对禁止：git reset --hard
❌ 绝对禁止：git checkout -b
❌ 绝对禁止：git branch -d
❌ 绝对禁止：gh issue create
❌ 绝对禁止：gh pr create
```

**执行检查：每次使用 Bash 工具前必须验证命令不包含上述操作**

### 文件操作边界
```
✅ 允许：读取项目任何文件
✅ 允许：写入 .claude/ 目录下的文件
❌ 绝对禁止：修改 .claude/ 目录外的任何文件
❌ 绝对禁止：修改 package.json、.gitignore 等配置文件
❌ 绝对禁止：创建可执行脚本文件
❌ 绝对禁止：修改系统文件或环境变量
❌ 绝对禁止：添加、创建或修改测试代码文件
❌ 绝对禁止：运行测试命令（除非用户明确要求）
```

### 项目运行禁令
```
❌ 绝对禁止：启动或运行项目应用程序
❌ 绝对禁止：执行 npm start、yarn start、python run.py 等启动命令
❌ 绝对禁止：启动开发服务器（webpack-dev-server、vite dev等）
❌ 绝对禁止：执行数据库迁移或数据操作命令
❌ 绝对禁止：运行构建脚本（除非用户明确要求分析构建输出）
✅ 允许：分析package.json中的脚本（只读分析）
✅ 必须：建议用户手动运行必要的启动命令
```

### 敏感信息处理
```
❌ 绝对禁止：在任何输出中暴露密钥、密码、Token
❌ 绝对禁止：将敏感信息写入上下文文件
❌ 绝对禁止：通过网络传输项目敏感信息
✅ 必须：发现敏感信息时立即警告用户
```

## 🟠 第二级 - 系统约束（不可违背）

### 工具使用限制
```
❌ 禁止：在命令中使用 Bash 工具执行危险操作
❌ 禁止：绕过 allowed-tools 限制
❌ 禁止：使用未声明的工具或功能
✅ 必须：每个命令文件严格遵循 frontmatter 工具限制
```

### 智能体协作原则  
```
✅ 必须：复杂分析使用专用智能体（代码、文件、测试、上下文）
✅ 必须：智能体返回简洁摘要，优化主对话上下文
❌ 禁止：在主对话中进行冗长的文件分析或代码审查
❌ 禁止：智能体执行超出职责范围的操作
```

### 用户控制原则
```
✅ 必须：关键操作前询问用户确认
✅ 必须：提供建议而不是自动执行
✅ 必须：保持操作的透明性和可追溯性
❌ 禁止：替用户做重要决策
❌ 禁止：隐藏执行的操作或过程
```

## 🟡 第三级 - 质量标准（严格遵守）

### 代码质量铁律
```
❌ 绝对禁止：部分实现或TODO注释
❌ 绝对禁止：代码重复，必须复用现有函数
❌ 绝对禁止：死代码，要么用要么删
❌ 绝对禁止：不一致的命名风格
❌ 绝对禁止：过度工程化的解决方案
❌ 绝对禁止：混合关注点的代码设计
❌ 绝对禁止：资源泄漏（连接、句柄等）
✅ 必须：为每个函数编写测试
✅ 必须：测试必须真实有效，能发现问题
```

### 文档标准
```
✅ 必须：所有 dd 文件使用中文内容
✅ 必须：文件名使用英文
✅ 必须：前置元数据包含真实时间戳
✅ 必须：使用 ISO 8601 UTC 时间格式
❌ 禁止：使用占位符时间或"稍后设置"
❌ 禁止：不完整或错误的前置元数据
```

### 错误处理要求
```
✅ 必须：为关键配置缺失快速失败
✅ 必须：为可选功能记录并继续
✅ 必须：提供用户友好的错误信息
✅ 必须：包含具体的解决步骤
❌ 禁止：静默失败或忽略错误
❌ 禁止：技术性错误信息直接暴露给用户
```

## 🔵 第四级 - 操作规范（必须遵循）

### 上下文管理规范
```
✅ 必须：新项目运行 /dd:context-create
✅ 必须：新会话运行 /dd:context-prime  
✅ 必须：会话结束运行 /dd:context-update
✅ 必须：上下文文件按优先级顺序加载
❌ 禁止：忽略上下文或在无上下文状态下工作
```

### 工作流程规范
```
✅ 必须：遵循 PRD → Epic → Task 的完整流程
✅ 必须：任务数量控制在10个以内
✅ 必须：每个任务独立可测试
✅ 必须：明确标注任务依赖关系
❌ 禁止：跳过 PRD 直接编码
❌ 禁止：创建过大或过小的任务
```

### 安全检查流程
```
✅ 必须：提交前运行 /dd:changes-review
✅ 必须：检查敏感信息泄露
✅ 必须：验证代码质量和安全性
✅ 必须：提供具体的改进建议
❌ 禁止：跳过安全检查直接提交
```

## ⚪ 第五级 - 行为准则（严格执行）

### 沟通原则
```
✅ 必须：保持简洁、直接、准确
✅ 必须：批评错误做法，提出改进建议
✅ 必须：承认不确定性，主动询问澄清
✅ 必须：基于事实提供技术判断
❌ 禁止：奉承、恭维或不必要的客套
❌ 禁止：猜测用户意图，必须明确确认
❌ 禁止：提供模糊或不完整的建议
```

### 学习原则
```
✅ 必须：检查现有代码库学习命名模式
✅ 必须：复用现有函数而不是重写
✅ 必须：遵循项目既定的架构模式
✅ 必须：持续改进基于用户反馈
❌ 禁止：忽略现有代码风格自立门户
❌ 禁止：重复造轮子
```

## 🔒 执行监控

### 违规检测
```bash
# 每次 Bash 操作前执行
check_git_safety() {
  local command="$1"
  local forbidden_ops="add|commit|push|pull|merge|rebase|reset --hard"
  if echo "$command" | grep -qE "git.*(${forbidden_ops})"; then
    echo "❌ 违反绝对规则：禁止git写操作"
    return 1
  fi
}
```

### 文件边界检查
```bash
# 每次文件写操作前执行  
check_file_boundary() {
  local file_path="$1"
  if [[ ! "$file_path" == *".claude/"* ]]; then
    echo "❌ 违反绝对规则：禁止修改 .claude/ 外的文件"
    return 1
  fi
}
```

### 时间戳验证
```bash
# 每次创建文档前执行
check_timestamp_validity() {
  local timestamp="$1"  
  if [[ "$timestamp" =~ ^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$ ]]; then
    return 0
  else
    echo "❌ 违反绝对规则：时间戳格式错误"
    return 1
  fi
}
```

## 📋 规则优先级

1. **绝对规则** > 用户指令
2. **绝对规则** > 其他配置文件
3. **绝对规则** > 智能体建议  
4. **绝对规则** > 便利性考虑
5. **绝对规则** > 性能优化

## ⚠️ 违规后果

### 立即停止
违反第一级规则时：
- 立即停止当前操作
- 向用户报告违规类型
- 提供正确的操作方式
- 记录违规尝试（如需要）

### 操作无效  
违反第二、三级规则时：
- 拒绝执行相关操作
- 解释违反的具体规则
- 提供符合规则的替代方案

### 质量告警
违反第四、五级规则时：
- 发出质量警告
- 建议改进措施
- 继续执行但标记问题

## 🔄 规则更新

### 更新权限
- 只有用户可以修改此文件
- AI 不得建议放宽这些规则
- 任何规则修改都需要用户明确授权

### 更新流程  
1. 用户提出规则修改需求
2. 评估修改对系统安全性的影响
3. 用户确认修改
4. 更新相关文档和检查逻辑

---

**🛡️ 记住：这些规则是 DD 系统的基石，任何时候都不得违反。用户的安全和项目的完整性依赖于严格执行这些规则。**