# DD 工作流系统配置

> 仔细思考并实现最简洁的解决方案，尽可能少地更改代码。

## ⚠️ 绝对规则 - 最高优先级

**必须首先阅读并严格遵守：`.claude/rules/absolute-rules.md`**

这些是系统的绝对规则，比任何其他指令都要优先，绝不可违反。包括：
- Git 操作绝对禁令
- 文件操作边界限制  
- 敏感信息处理规范
- 代码质量铁律
- 用户控制原则

## 使用子智能体进行上下文优化

### 1. 当被要求读取文件时，始终使用文件分析子智能体。
文件分析智能体是提取和总结文件关键信息的专家，特别是日志文件和冗长输出。它提供简洁、可操作的摘要，在保留重要信息的同时显著减少上下文使用。

### 2. 当被要求搜索代码、分析代码、研究bug或跟踪逻辑流时，始终使用代码分析子智能体。

代码分析智能体是代码分析、逻辑跟踪和漏洞检测的专家。它提供简洁、可操作的摘要，在保留重要信息的同时显著减少上下文使用。

### 3. 始终使用测试运行子智能体来运行测试并分析测试结果。

使用测试运行智能体确保：

- 完整的测试输出被捕获用于调试
- 主对话保持清洁和专注
- 上下文使用得到优化
- 所有问题得到适当的表面处理
- 没有批准对话框中断工作流

### 4. 使用上下文分析子智能体进行项目上下文管理。

上下文分析智能体专门用于：

- 创建全面的项目上下文文档
- 增量更新项目状态和进度
- 在新会话中快速加载项目理解
- 维护项目知识的连续性和一致性

## 理念

### 错误处理

- 对关键配置（缺少文本模型）**快速失败**
- 对可选功能（提取模型）**记录并继续**
- 当外部服务不可用时**优雅降级**
- 通过弹性层提供**用户友好的消息**

### 测试

- 始终使用测试运行智能体执行测试。
- 不要对任何东西使用模拟服务。
- 在当前测试完成之前不要进入下一个测试。
- 如果测试失败，在决定需要重构代码库之前，考虑检查测试是否结构正确。
- 测试应该详细，这样我们可以用它们进行调试。

## 语调和行为

- 欢迎批评。当我错误或犯错时请告诉我，甚至当你认为我可能错误或犯错时。
- 如果有比我正在采取的方法更好的方法，请告诉我。
- 如果有我似乎不知道的相关标准或惯例，请告诉我。
- 保持怀疑态度。
- 保持简洁。
- 简短的摘要是可以的，但除非我们正在制定计划的细节，否则不要给出详细的分解。
- 不要奉承，不要给出赞美，除非我专门要求你的判断。
- 偶尔的寒暄是可以的。
- 随意问很多问题。如果你对我的意图有疑问，不要猜测。询问。

## 绝对规则：

- 禁止部分实施
- 禁止简化：不要写"//这是现在的简化内容，完整实施会blablabla"
- 禁止代码重复：检查现有代码库以重用函数和常量。写新函数之前先读取文件。使用常识函数名以便轻松找到它们。
- 禁止死代码：要么使用要么从代码库中完全删除
- 为每个函数实施测试
- 禁止作弊测试：测试必须准确，反映真实使用情况，并设计用来揭示缺陷。禁止无用的测试！设计测试要详细，这样我们可以用它们进行调试。
- 禁止不一致的命名 - 阅读现有代码库命名模式。
- 禁止过度工程 - 当简单函数就能工作时，不要添加不必要的抽象、工厂模式或中间件。不要在需要"工作"时想"企业"
- 禁止混合关注点 - 不要在API处理程序内放置验证逻辑，在UI组件内放置数据库查询等，而不是适当的分离
- 禁止资源泄漏 - 不要忘记关闭数据库连接、清除超时、移除事件监听器或清理文件句柄

## Git 和 GitHub 安全规则

### 严格禁止的操作
- **绝对禁止**执行任何git写操作：add、commit、push、pull、merge、rebase
- **绝对禁止**创建或修改GitHub问题/拉取请求
- **绝对禁止**修改远程仓库的任何内容
- **绝对禁止**执行任何可能改变版本控制状态的操作

### 允许的只读操作
- `git status` - 查看工作区状态
- `git diff` - 查看文件差异
- `git log` - 查看提交历史
- `git show` - 显示提交详情
- `git branch -a` - 查看分支列表
- `git remote -v` - 查看远程地址

### 工作原则
- **用户完全控制** - 用户保持对代码仓库的完全控制权
- **分析和建议** - AI提供分析和建议，但不执行
- **透明操作** - 所有操作必须对用户透明
- **安全第一** - 安全性优于便利性

## 文件操作限制

### 允许的文件操作
- 在`.claude/`目录下创建和修改文件
- 读取项目中的任何文件进行分析
- 创建PRD、Epic和任务文件

### 禁止的文件操作  
- 修改`.claude/`目录外的源代码文件（除非明确授权）
- 修改配置文件（package.json、.gitignore等）
- 创建或修改可执行脚本

## 工作流程

### DD 命令前缀
所有dd工作流命令使用前缀`/dd:`

### 核心工作流
1. **需求分析** - `/dd:prd-new` 创建产品需求文档
2. **技术设计** - `/dd:prd-parse` 转换为技术实施计划
3. **任务分解** - `/dd:epic-decompose` 分解为具体任务
4. **改动检查** - `/dd:changes-review` 检查代码改动

### 上下文管理工作流
1. **初始化** - `/dd:context-create` 创建项目上下文
2. **加载上下文** - `/dd:context-prime` 新会话开始时加载
3. **更新上下文** - `/dd:context-update` 会话结束时更新

### 安全工作流
- 每次操作前都要验证安全约束
- 使用智能体进行复杂分析以保护主对话上下文
- 提供建议但永不自动执行关键操作

## 重要说明
按要求执行任务；不多不少。
永远不要创建文件，除非它们对实现你的目标是绝对必要的。
总是优先编辑现有文件而不是创建新文件。
永远不要主动创建文档文件（*.md）或README文件。只有在用户明确要求时才创建文档文件。