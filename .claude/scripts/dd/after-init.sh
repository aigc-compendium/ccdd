#!/bin/bash

# åˆå§‹åŒ–åå¤„ç†è„šæœ¬
# ç”± dd:init å’Œ dd:init-exist å‘½ä»¤è°ƒç”¨
# æ ¹æ® JSON å…¥å‚ç”Ÿæˆå¯¹åº”çš„æ–‡ä»¶å¹¶è®°å½•å¤´è„‘é£æš´å¯¹è¯

set -e

echo "ğŸ”§ æ‰§è¡Œåˆå§‹åŒ–åå¤„ç†..."
echo ""

# è§£æ JSON å‚æ•°
init_data="$1"
if [ -z "$init_data" ] || [ "$init_data" = "null" ]; then
    echo "âŒ é”™è¯¯: ç¼ºå°‘åˆå§‹åŒ–æ•°æ® JSON å‚æ•°"
    echo "ç”¨æ³•: bash after-init.sh '<json_data>'"
    exit 1
fi

# æå– JSON æ•°æ®ä¸­çš„å­—æ®µ
project_name=$(echo "$init_data" | jq -r '.project_name // "é»˜è®¤é¡¹ç›®åç§°"')
project_type=$(echo "$init_data" | jq -r '.project_type // "Webåº”ç”¨"')
tech_stack=$(echo "$init_data" | jq -r '.tech_stack // "Node.js, React"')
architecture=$(echo "$init_data" | jq -r '.architecture // "åˆ†å±‚æ¶æ„"')
conversation=$(echo "$init_data" | jq -r '.conversation // ""')

echo "ğŸ“‹ é¡¹ç›®é…ç½®ä¿¡æ¯: "
echo "  é¡¹ç›®åç§°: $project_name"
echo "  é¡¹ç›®ç±»å‹: $project_type" 
echo "  æŠ€æœ¯æ ˆ: $tech_stack"
echo "  æ¶æ„æ¨¡å¼: $architecture"
echo ""

## 0. è®°å½•å¤´è„‘é£æš´å¯¹è¯å†å²

if [ -n "$conversation" ] && [ "$conversation" != "" ]; then
    echo "ğŸ’¬ è®°å½•å¤´è„‘é£æš´å¯¹è¯å†å²..."
    
    # ç¡®ä¿å¯¹è¯ç›®å½•å­˜åœ¨
    mkdir -p .claude/chats/init
    
    # ä¼˜åŒ–: ç›´æ¥ä½¿ç”¨æ—¶é—´æˆ³é¿å…æ–‡ä»¶æ£€æŸ¥
    chat_filename="init-$(date +"%Y%m%d-%H%M%S").md"
    chat_filepath=".claude/chats/init/$chat_filename"
    
    # åˆ›å»ºå¯¹è¯è®°å½•æ–‡ä»¶
    cat > "$chat_filepath" << EOF
---
type: comminicate
project_name: $project_name
participants: [user, ai]
---

# é¡¹ç›®åˆå§‹åŒ–å¤´è„‘é£æš´å¯¹è¯

## é¡¹ç›®ä¿¡æ¯

- **é¡¹ç›®åç§°**: $project_name
- **é¡¹ç›®ç±»å‹**: $project_type
- **æŠ€æœ¯æ ˆ**: $tech_stack
- **æ¶æ„æ¨¡å¼**: $architecture

## å¯¹è¯å†…å®¹

$conversation

## å¯¹è¯æ€»ç»“

é€šè¿‡æœ¬æ¬¡å¤´è„‘é£æš´å¯¹è¯, ç¡®å®šäº†é¡¹ç›®çš„åŸºç¡€ä¿¡æ¯å’ŒæŠ€æœ¯é€‰å‹, ä¸ºåç»­å¼€å‘å¥ å®šäº†åŸºç¡€. 

## åç»­è¡ŒåŠ¨

åŸºäºå¯¹è¯ç»“æœ, ç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®ä¸Šä¸‹æ–‡æ–‡ä»¶, å¹¶é…ç½®DDå·¥ä½œæµç³»ç»Ÿ. 
EOF
    
    echo "  âœ… å¯¹è¯å†å²å·²ä¿å­˜è‡³: $chat_filepath"
    echo ""
else
    echo "â„¹ï¸  æœªæä¾›å¯¹è¯å†å², è·³è¿‡å¯¹è¯è®°å½•"
    echo ""
fi

## 1. æ›´æ–°é¡¹ç›®ä¸Šä¸‹æ–‡æ–‡ä»¶

echo "ğŸ“ æ›´æ–°é¡¹ç›®ä¸Šä¸‹æ–‡æ–‡ä»¶..."

# æ›´æ–° project.md
cat > .claude/context/project.md << EOF
---
name: $project_name
version: 1.0.0
type: $project_type
status: å¼€å‘ä¸­
initialized_at: $(date -u +"%Y-%m-%dT%H:%M:%SZ")
---

# é¡¹ç›®åŸºç¡€ä¿¡æ¯

## é¡¹ç›®æè¿°
$project_name æ˜¯ä¸€ä¸ªåŸºäºç°ä»£æŠ€æœ¯æ ˆçš„ $project_type, æ—¨åœ¨æä¾›ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒå’Œé«˜è´¨é‡çš„ä»£ç å®ç°.

## é¡¹ç›®ç›®æ ‡
- æ„å»ºé«˜è´¨é‡, å¯ç»´æŠ¤çš„è½¯ä»¶ç³»ç»Ÿ
- æä¾›ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ
- éµå¾ªæœ€ä½³å®è·µå’Œå®‰å…¨æ ‡å‡†
- å®ç°å¯æ‰©å±•çš„ç³»ç»Ÿæ¶æ„

## ç›®æ ‡ç”¨æˆ·
- ä¸»è¦ç”¨æˆ·ç¾¤ä½“: [æ ¹æ®é¡¹ç›®ç±»å‹ç¡®å®š]
- ä½¿ç”¨åœºæ™¯: [å…·ä½“çš„ç”¨æˆ·ä½¿ç”¨åœºæ™¯]

## æ ¸å¿ƒä»·å€¼
- ä¸ºç”¨æˆ·æä¾›æ ¸å¿ƒä»·å€¼å’Œè§£å†³æ–¹æ¡ˆ
- æé«˜å·¥ä½œæ•ˆç‡å’Œç”¨æˆ·æ»¡æ„åº¦
- æ”¯æŒä¸šåŠ¡ç›®æ ‡çš„å®ç°

## é¡¹ç›®èŒƒå›´
### åŒ…å«çš„åŠŸèƒ½
- æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
- ç”¨æˆ·ç®¡ç†å’Œè®¤è¯
- æ•°æ®ç®¡ç†å’Œå¤„ç†

### ä¸åŒ…å«çš„åŠŸèƒ½
- æ˜ç¡®æ’é™¤çš„åŠŸèƒ½èŒƒå›´

## æˆåŠŸæŒ‡æ ‡
- æŠ€æœ¯æŒ‡æ ‡: æ€§èƒ½, å¯é æ€§, å®‰å…¨æ€§
- ä¸šåŠ¡æŒ‡æ ‡: ç”¨æˆ·æ»¡æ„åº¦, ä½¿ç”¨ç‡
- è´¨é‡æŒ‡æ ‡: ä»£ç è´¨é‡, æµ‹è¯•è¦†ç›–ç‡

## é¡¹ç›®çº¦æŸ
- æ—¶é—´çº¦æŸ: æŒ‰è®¡åˆ’äº¤ä»˜
- æŠ€æœ¯çº¦æŸ: ä½¿ç”¨æŒ‡å®šæŠ€æœ¯æ ˆ
- èµ„æºçº¦æŸ: äººåŠ›å’Œé¢„ç®—é™åˆ¶
- åˆè§„çº¦æŸ: å®‰å…¨å’Œéšç§è¦æ±‚
EOF

echo "  âœ… å·²æ›´æ–° project.md"

# æ›´æ–° tech-stack.md
cat > .claude/context/tech-stack.md << EOF
---
last_updated: $(date -u +"%Y-%m-%dT%H:%M:%SZ")
version: 1.0.0
---

# æŠ€æœ¯æ ˆä¿¡æ¯

## ä¸»è¦æŠ€æœ¯é€‰æ‹©
åŸºäºé¡¹ç›®éœ€æ±‚é€‰æ‹©çš„æŠ€æœ¯æ ˆ: $tech_stack

## å‰ç«¯æŠ€æœ¯æ ˆ
### æ ¸å¿ƒæ¡†æ¶
- **ä¸»æ¡†æ¶**: æ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©
- **æ„å»ºå·¥å…·**: ç°ä»£åŒ–æ„å»ºå·¥å…·
- **åŒ…ç®¡ç†å™¨**: npm/yarn

### UI å’Œæ ·å¼
- **ç»„ä»¶åº“**: ä¸»æµUIç»„ä»¶åº“
- **æ ·å¼æ–¹æ¡ˆ**: CSSé¢„å¤„ç†å™¨æˆ–CSS-in-JS
- **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯é€‚é…æ–¹æ¡ˆ

## åç«¯æŠ€æœ¯æ ˆ
### æ ¸å¿ƒæŠ€æœ¯
- **ä¸»è¯­è¨€å’Œæ¡†æ¶**: æ ¹æ®æŠ€æœ¯æ ˆé€‰æ‹©
- **æ•°æ®åº“**: é€‚åˆä¸šåŠ¡éœ€æ±‚çš„æ•°æ®åº“é€‰æ‹©
- **ç¼“å­˜æ–¹æ¡ˆ**: Redisæˆ–å…¶ä»–ç¼“å­˜è§£å†³æ–¹æ¡ˆ

### APIå’ŒæœåŠ¡
- **APIè®¾è®¡**: RESTfulæˆ–GraphQL
- **è®¤è¯æ–¹æ¡ˆ**: JWTæˆ–å…¶ä»–è®¤è¯æœºåˆ¶
- **æ–‡æ¡£å·¥å…·**: APIæ–‡æ¡£ç”Ÿæˆå·¥å…·

## åŸºç¡€è®¾æ–½
### éƒ¨ç½²ç¯å¢ƒ
- **å®¹å™¨åŒ–**: Dockerå®¹å™¨åŒ–éƒ¨ç½²
- **äº‘æœåŠ¡**: äº‘å¹³å°é€‰æ‹©
- **CI/CD**: è‡ªåŠ¨åŒ–éƒ¨ç½²æµæ°´çº¿

### ç›‘æ§å’Œæ—¥å¿—
- **ç›‘æ§ç³»ç»Ÿ**: ç³»ç»Ÿæ€§èƒ½ç›‘æ§
- **æ—¥å¿—ç®¡ç†**: é›†ä¸­åŒ–æ—¥å¿—ç®¡ç†
- **é”™è¯¯è·Ÿè¸ª**: é”™è¯¯ç›‘æ§å’ŒæŠ¥è­¦

## å¼€å‘å·¥å…·é“¾
### ç‰ˆæœ¬æ§åˆ¶
- **ä»£ç ä»“åº“**: Git + GitHub/GitLab
- **åˆ†æ”¯ç­–ç•¥**: Git Flowæˆ–GitHub Flow
- **ä»£ç è¯„å®¡**: Pull Requestæµç¨‹

### å¼€å‘ç¯å¢ƒ
- **IDE/ç¼–è¾‘å™¨**: æ¨èçš„å¼€å‘å·¥å…·
- **è°ƒè¯•å·¥å…·**: è°ƒè¯•å’Œæ€§èƒ½åˆ†æå·¥å…·
- **æµ‹è¯•æ¡†æ¶**: å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æ¡†æ¶

## å®‰å…¨å’Œè´¨é‡
### ä»£ç è´¨é‡
- **ä»£ç è§„èŒƒ**: ESLintã€Prettierç­‰å·¥å…·
- **é™æ€åˆ†æ**: ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·
- **æµ‹è¯•ç­–ç•¥**: æµ‹è¯•é©±åŠ¨å¼€å‘

### å®‰å…¨æªæ–½
- **ä»£ç æ‰«æ**: å®‰å…¨æ¼æ´æ‰«æ
- **ä¾èµ–ç®¡ç†**: ä¾èµ–å®‰å…¨æ£€æŸ¥
- **å®‰å…¨æœ€ä½³å®è·µ**: å®‰å…¨ç¼–ç è§„èŒƒ
EOF

echo "  âœ… å·²æ›´æ–° tech-stack.md"

# æ›´æ–° architecture.md
cat > .claude/context/architecture.md << EOF
---
last_updated: $(date -u +"%Y-%m-%dT%H:%M:%SZ")
version: 1.0.0
architecture_pattern: $architecture
---

# é¡¹ç›®æ¶æ„

## æ•´ä½“æ¶æ„
### æ¶æ„é£æ ¼
é‡‡ç”¨ $architecture æ¶æ„æ¨¡å¼, ç¡®ä¿ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå®‰å…¨æ€§. 

### æ ¸å¿ƒåŸåˆ™
- æ¨¡å—åŒ–è®¾è®¡: æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œå’ŒèŒè´£åˆ†ç¦»
- ä½è€¦åˆé«˜å†…èš: å‡å°‘æ¨¡å—é—´ä¾èµ–, æé«˜å†…èšæ€§
- å¯æ‰©å±•æ€§ä¼˜å…ˆ: æ”¯æŒç³»ç»Ÿçš„æ¨ªå‘å’Œçºµå‘æ‰©å±•
- å®‰å…¨æ€§å†…ç½®: å®‰å…¨è€ƒè™‘èå…¥æ¶æ„è®¾è®¡

## ç³»ç»Ÿåˆ†å±‚
æ ¹æ®é€‰æ‹©çš„æ¶æ„æ¨¡å¼è¿›è¡Œåˆç†çš„ç³»ç»Ÿåˆ†å±‚: 

### è¡¨ç°å±‚ (Presentation Layer)
- ç”¨æˆ·ç•Œé¢ç»„ä»¶å’Œäº¤äº’
- APIç«¯ç‚¹å®šä¹‰å’Œè·¯ç”±
- è¯·æ±‚éªŒè¯å’Œå“åº”æ ¼å¼åŒ–
- ç”¨æˆ·è®¤è¯å’Œä¼šè¯ç®¡ç†

### ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)
- æ ¸å¿ƒä¸šåŠ¡è§„åˆ™å®ç°
- é¢†åŸŸæ¨¡å‹å’Œå®ä½“å®šä¹‰
- ä¸šåŠ¡æµç¨‹ç¼–æ’å’Œæ§åˆ¶
- æ•°æ®éªŒè¯å’Œä¸šåŠ¡éªŒè¯

### æ•°æ®è®¿é—®å±‚ (Data Access Layer)
- æ•°æ®æ¨¡å‹å®šä¹‰å’Œæ˜ å°„
- æ•°æ®åº“è®¿é—®å’Œæ“ä½œ
- æ•°æ®è½¬æ¢å’Œå¤„ç†
- ç¼“å­˜ç­–ç•¥å®ç°

## å…³é”®ç»„ä»¶
### æ ¸å¿ƒæ¨¡å—
- **è®¤è¯æˆæƒæ¨¡å—**: ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- **ä¸šåŠ¡æ ¸å¿ƒæ¨¡å—**: ä¸»è¦ä¸šåŠ¡é€»è¾‘å®ç°
- **æ•°æ®ç®¡ç†æ¨¡å—**: æ•°æ®å­˜å‚¨å’Œè®¿é—®

### æ”¯æ’‘æ¨¡å—
- **é…ç½®ç®¡ç†æ¨¡å—**: ç³»ç»Ÿé…ç½®å’Œç¯å¢ƒç®¡ç†
- **æ—¥å¿—ç›‘æ§æ¨¡å—**: ç³»ç»Ÿç›‘æ§å’Œæ—¥å¿—ç®¡ç†
- **é€šç”¨å·¥å…·æ¨¡å—**: å…±äº«å·¥å…·å’Œå®ç”¨å‡½æ•°

## æ•°æ®æ¶æ„
### æ•°æ®æ¨¡å‹è®¾è®¡
- æ ¸å¿ƒå®ä½“åŠå…¶å…³ç³»å®šä¹‰
- æ•°æ®æµå‘å’Œè½¬æ¢è§„åˆ™
- æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ä¿è¯

### å­˜å‚¨ç­–ç•¥
- ä¸»æ•°æ®åº“é€‰å‹å’Œè®¾è®¡åŸåˆ™
- ç¼“å­˜å±‚è®¾è®¡å’Œç¼“å­˜ç­–ç•¥
- æ•°æ®å¤‡ä»½å’Œæ¢å¤æ–¹æ¡ˆ

## é›†æˆå’Œé€šä¿¡
### å†…éƒ¨é€šä¿¡
- æ¨¡å—é—´é€šä¿¡æœºåˆ¶
- äº‹ä»¶é©±åŠ¨æ¶æ„è€ƒè™‘
- æ¶ˆæ¯é˜Ÿåˆ—å’Œå¼‚æ­¥å¤„ç†

### å¤–éƒ¨é›†æˆ
- ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆç­–ç•¥
- APIè®¾è®¡å’Œç‰ˆæœ¬ç®¡ç†
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

## éåŠŸèƒ½æ€§éœ€æ±‚
### æ€§èƒ½è¦æ±‚
- å“åº”æ—¶é—´ç›®æ ‡
- å¹¶å‘ç”¨æˆ·æ”¯æŒ
- æ•°æ®å¤„ç†èƒ½åŠ›

### å¯ç”¨æ€§å’Œå¯é æ€§
- ç³»ç»Ÿå¯ç”¨æ€§ç›®æ ‡
- æ•…éšœæ¢å¤æœºåˆ¶
- å®¹ç¾å’Œå¤‡ä»½ç­–ç•¥

### æ‰©å±•æ€§è®¾è®¡
- æ°´å¹³æ‰©å±•èƒ½åŠ›
- å‚ç›´æ‰©å±•èƒ½åŠ›
- å¾®æœåŠ¡åŒ–å‡†å¤‡

## å®‰å…¨æ¶æ„
### å®‰å…¨é˜²æŠ¤å±‚æ¬¡
- ç½‘ç»œå®‰å…¨: é˜²ç«å¢™å’Œç½‘ç»œéš”ç¦»
- åº”ç”¨å®‰å…¨: èº«ä»½è®¤è¯å’Œè®¿é—®æ§åˆ¶
- æ•°æ®å®‰å…¨: åŠ å¯†å­˜å‚¨å’Œä¼ è¾“
- è¿ç»´å®‰å…¨: å®‰å…¨è¿ç»´å’Œç›‘æ§

### å®‰å…¨æœ€ä½³å®è·µ
- æœ€å°æƒé™åŸåˆ™
- æ·±åº¦é˜²å¾¡ç­–ç•¥
- å®‰å…¨å¼€å‘ç”Ÿå‘½å‘¨æœŸ
- å®šæœŸå®‰å…¨å®¡è®¡å’Œè¯„ä¼°
EOF

echo "  âœ… å·²æ›´æ–° architecture.md"

# æ›´æ–° current-status.md
cat > .claude/context/current-status.md << EOF
---
last_updated: $(date -u +"%Y-%m-%dT%H:%M:%SZ")
project_phase: é¡¹ç›®åˆå§‹åŒ–å®Œæˆ
overall_progress: 5%
---

# å½“å‰é¡¹ç›®çŠ¶æ€

## é¡¹ç›®é˜¶æ®µ
**å½“å‰é˜¶æ®µ**: é¡¹ç›®åˆå§‹åŒ–å®Œæˆ
- [x] é¡¹ç›®åˆå§‹åŒ–å’Œé…ç½®
- [x] DDå·¥ä½œæµç³»ç»Ÿé…ç½®
- [x] åŸºç¡€æ¶æ„è®¾è®¡
- [ ] æ ¸å¿ƒåŠŸèƒ½å¼€å‘
- [ ] æµ‹è¯•å’Œä¼˜åŒ–
- [ ] éƒ¨ç½²ä¸Šçº¿

## åŠŸèƒ½å®Œæˆæƒ…å†µ
### å·²å®ŒæˆåŠŸèƒ½ (0/0)
é¡¹ç›®åˆšåˆšå®Œæˆåˆå§‹åŒ–, å°šæœªå¼€å§‹åŠŸèƒ½å¼€å‘

### è§„åˆ’ä¸­åŠŸèƒ½ (0/0)  
ç­‰å¾…åŠŸèƒ½éœ€æ±‚çš„æ·»åŠ å’Œè§„åˆ’

## æŠ€æœ¯å®æ–½è¿›åº¦
### åŸºç¡€è®¾æ–½ (20%)
- [x] DDå·¥ä½œæµç³»ç»Ÿé…ç½®
- [x] é¡¹ç›®ä¸Šä¸‹æ–‡å»ºç«‹
- [x] æŠ€æœ¯æ¶æ„å®šä¹‰
- [ ] å¼€å‘ç¯å¢ƒæ­å»º
- [ ] æ•°æ®åº“è®¾è®¡
- [ ] éƒ¨ç½²ç¯å¢ƒå‡†å¤‡

### å¼€å‘å‡†å¤‡ (10%)
- [x] é¡¹ç›®ç»“æ„è§„åˆ’
- [x] æŠ€æœ¯æ ˆç¡®è®¤
- [ ] å¼€å‘è§„èŒƒåˆ¶å®š
- [ ] ä»£ç åº“åˆå§‹åŒ–
- [ ] CI/CDæµç¨‹å»ºç«‹

## è´¨é‡æŒ‡æ ‡
### å½“å‰æŒ‡æ ‡
- **DDå·¥ä½œæµé…ç½®**: âœ… å·²å®Œæˆ
- **é¡¹ç›®æ–‡æ¡£å®Œæ•´æ€§**: âœ… åŸºç¡€æ–‡æ¡£å·²å»ºç«‹
- **æŠ€æœ¯æ¶æ„æ¸…æ™°åº¦**: âœ… æ¶æ„æ–¹æ¡ˆå·²ç¡®å®š

### ç›®æ ‡æŒ‡æ ‡
- **ä»£ç è´¨é‡**: ç›®æ ‡90%ä»¥ä¸Šè´¨é‡åˆ†æ•°
- **æµ‹è¯•è¦†ç›–ç‡**: ç›®æ ‡80%ä»¥ä¸Šè¦†ç›–ç‡  
- **æ€§èƒ½æŒ‡æ ‡**: å“åº”æ—¶é—´<2ç§’
- **å®‰å…¨è¯„çº§**: Açº§å®‰å…¨æ ‡å‡†

## ä¸‹ä¸€æ­¥è®¡åˆ’
### è¿‘æœŸä»»åŠ¡ï¼ˆ1-2å‘¨ï¼‰
1. ä½¿ç”¨ /dd:feature-add æ·»åŠ ç¬¬ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½
2. è¿›è¡ŒåŠŸèƒ½ä»»åŠ¡åˆ†è§£ /dd:task-decompose
3. å¼€å§‹æ ¸å¿ƒåŠŸèƒ½å¼€å‘ /dd:feature-start
4. å»ºç«‹åŸºç¡€å¼€å‘ç¯å¢ƒå’Œå·¥å…·é“¾

### ä¸­æœŸç›®æ ‡ï¼ˆ1ä¸ªæœˆï¼‰
1. å®Œæˆæ ¸å¿ƒåŠŸèƒ½çš„MVPç‰ˆæœ¬
2. å»ºç«‹å®Œæ•´çš„æµ‹è¯•ä½“ç³»
3. é…ç½®CI/CDè‡ªåŠ¨åŒ–æµç¨‹
4. è¿›è¡Œç¬¬ä¸€è½®ä»£ç è´¨é‡å®¡æŸ¥

### é•¿æœŸç›®æ ‡ï¼ˆ3ä¸ªæœˆï¼‰
1. å®Œæˆä¸»è¦åŠŸèƒ½æ¨¡å—å¼€å‘
2. ç³»ç»Ÿé›†æˆå’Œæ€§èƒ½ä¼˜åŒ–
3. å®‰å…¨è¯„ä¼°å’ŒåŠ å›º
4. å‡†å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

## å›¢é˜ŸçŠ¶æ€
### å¼€å‘èµ„æº
- DDå·¥ä½œæµç³»ç»Ÿ: âœ… å·²é…ç½®å¹¶å¯ç”¨
- æ™ºèƒ½è¾…åŠ©å¼€å‘: âœ… å¯ä½¿ç”¨ /dd:chat è¿›è¡ŒæŠ€æœ¯å’¨è¯¢
- é¡¹ç›®ç®¡ç†: âœ… åŸºäºä»»åŠ¡çš„è¿›åº¦è·Ÿè¸ª

### å½“å‰é‡ç‚¹
- æ˜ç¡®ç¬¬ä¸€ä¸ªè¦å¼€å‘çš„æ ¸å¿ƒåŠŸèƒ½
- å»ºç«‹å¼€å‘ç¯å¢ƒå’Œå·¥å…·é“¾
- å¼€å§‹åŠŸèƒ½è®¾è®¡å’Œå¼€å‘å·¥ä½œ

## é£é™©å’ŒæŒ‘æˆ˜
### å½“å‰é£é™©
- åŠŸèƒ½éœ€æ±‚å°šæœªæ˜ç¡®å®šä¹‰
- å¼€å‘ç¯å¢ƒå°šæœªæ­å»ºå®Œæˆ

### ç¼“è§£æªæ–½
- ä½¿ç”¨ /dd:chat è¿›è¡Œéœ€æ±‚åˆ†æè®¨è®º
- ä½¿ç”¨ /dd:feature-add ç³»ç»ŸåŒ–æ·»åŠ åŠŸèƒ½
- éµå¾ªDDå·¥ä½œæµç¡®ä¿è´¨é‡å’Œè¿›åº¦

## å»ºè®®çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. **æ˜ç¡®æ ¸å¿ƒåŠŸèƒ½**: ä½¿ç”¨ /dd:chat è®¨è®ºå’Œç¡®å®šç¬¬ä¸€ä¸ªè¦å¼€å‘çš„åŠŸèƒ½
2. **æ·»åŠ åŠŸèƒ½**: ä½¿ç”¨ /dd:feature-add <åŠŸèƒ½åç§°> åˆ›å»ºåŠŸèƒ½è§„åˆ’
3. **ä»»åŠ¡åˆ†è§£**: ä½¿ç”¨ /dd:task-decompose <åŠŸèƒ½åç§°> è¿›è¡Œä»»åŠ¡è§„åˆ’
4. **å¼€å§‹å¼€å‘**: ä½¿ç”¨ /dd:feature-start <åŠŸèƒ½åç§°> å¼€å§‹å¼€å‘
5. **æŒç»­æ”¹è¿›**: å®šæœŸä½¿ç”¨ /dd:code-reflect è¿›è¡Œä»£ç è´¨é‡åæ€
EOF

echo "  âœ… å·²æ›´æ–° current-status.md"

## 2. æ¸…ç†æ¨¡æ¿åŠŸèƒ½ç›®å½•

echo ""
echo "ğŸ§¹ æ¸…ç†æ¨¡æ¿åŠŸèƒ½ç›®å½•..."

# åˆ é™¤ç¤ºä¾‹åŠŸèƒ½ç›®å½•
if [ -d ".claude/features/ç”¨æˆ·è®¤è¯ç³»ç»Ÿ" ]; then
  rm -rf ".claude/features/ç”¨æˆ·è®¤è¯ç³»ç»Ÿ"
  echo "  âœ… å·²åˆ é™¤ç¤ºä¾‹åŠŸèƒ½: ç”¨æˆ·è®¤è¯ç³»ç»Ÿ"
else
  echo "  â„¹ï¸  ç¤ºä¾‹åŠŸèƒ½ç›®å½•ä¸å­˜åœ¨, è·³è¿‡æ¸…ç†"
fi

# ç¡®ä¿ features ç›®å½•å­˜åœ¨ä½†ä¸ºç©º
mkdir -p .claude/features
echo "  âœ… åŠŸèƒ½ç›®å½•å·²å‡†å¤‡å°±ç»ª"

## 3. CLAUDE.md æ–‡ä»¶çŠ¶æ€æ£€æŸ¥

echo ""
echo "ğŸ“‹ æ£€æŸ¥ CLAUDE.md æ–‡ä»¶çŠ¶æ€..."

# æ£€æŸ¥DDç³»ç»Ÿé…ç½®æ–‡ä»¶
if [ ! -f ".claude/CLAUDE.md" ]; then
    echo "âŒ é”™è¯¯: .claude/CLAUDE.md æ–‡ä»¶ä¸å­˜åœ¨"
    exit 1
fi
echo "  âœ… DDç³»ç»Ÿé…ç½®æ–‡ä»¶å­˜åœ¨"

# æ£€æŸ¥æ ¹ç›®å½•é…ç½®æ–‡ä»¶çŠ¶æ€
if [ -f "CLAUDE.md" ]; then
    echo "  ğŸ” æ£€æµ‹åˆ°æ ¹ç›®å½•ç°æœ‰ CLAUDE.md æ–‡ä»¶"
    echo "  ğŸ“Š ç°æœ‰æ–‡ä»¶: $(wc -l < CLAUDE.md) è¡Œ"
else
    echo "  ğŸ“„ æ ¹ç›®å½•æ— ç°æœ‰ CLAUDE.md æ–‡ä»¶"
fi
echo "  ğŸ“Š DDé…ç½®æ–‡ä»¶: $(wc -l < .claude/CLAUDE.md) è¡Œ"

echo "  â­ï¸  CLAUDE.md æ™ºèƒ½åˆå¹¶å°†åœ¨ä¸‹ä¸€æ­¥éª¤è‡ªåŠ¨æ‰§è¡Œ"

## 4. å®ŒæˆåçŠ¶æ€æ›´æ–°

echo ""
echo "ğŸ“Š æ›´æ–°åˆå§‹åŒ–å®ŒæˆçŠ¶æ€..."

# è®°å½•åˆå§‹åŒ–å®Œæˆæ—¶é—´å’ŒçŠ¶æ€
sed -i.bak "s/project_phase: é¡¹ç›®åˆå§‹åŒ–å®Œæˆ/project_phase: å·²åˆå§‹åŒ–/" .claude/context/current-status.md 2>/dev/null
sed -i.bak "s/overall_progress: 5%/overall_progress: 10%/" .claude/context/current-status.md 2>/dev/null
rm -f .claude/context/current-status.md.bak

echo "  âœ… é¡¹ç›®çŠ¶æ€å·²æ›´æ–°"

## 5. å®Œæˆæ€»ç»“

echo ""
echo "ğŸ‰ åˆå§‹åŒ–åå¤„ç†å®Œæˆï¼"
echo ""
echo "ğŸ“‹ å¤„ç†å®Œæˆé¡¹ç›®: "
echo "  ğŸ“ é¡¹ç›®åç§°: $project_name"
echo "  ğŸ—ï¸ æ¶æ„æ¨¡å¼: $architecture"  
echo "  âš™ï¸ æŠ€æœ¯æ ˆ: $tech_stack"
echo ""
echo "âœ… å·²å®Œæˆçš„å·¥ä½œ: "
echo "  â€¢ é¡¹ç›®ä¸Šä¸‹æ–‡æ–‡ä»¶å·²æ›´æ–°"
echo "  â€¢ æ¨¡æ¿åŠŸèƒ½ç›®å½•å·²æ¸…ç†"
echo "  â€¢ CLAUDE.md é…ç½®å·²å¤„ç†"
echo "  â€¢ ç»å¯¹è§„åˆ™å·²æ°¸ä¹…åŠ è½½"
echo ""
echo "ğŸš€ å»ºè®®çš„ä¸‹ä¸€æ­¥æ“ä½œ: "
echo "  â€¢ ä½¿ç”¨ /dd:chat è®¨è®ºé¡¹ç›®å…·ä½“éœ€æ±‚"
echo "  â€¢ ä½¿ç”¨ /dd:feature-add <åŠŸèƒ½å> æ·»åŠ ç¬¬ä¸€ä¸ªåŠŸèƒ½"
echo "  â€¢ ä½¿ç”¨ /dd:status æŸ¥çœ‹é¡¹ç›®æ•´ä½“çŠ¶æ€"
echo ""
echo "ğŸ’¡ å¿«é€Ÿå¼€å§‹: "
echo "  /dd:chat"
echo "  æˆ‘æƒ³ä¸ºè¿™ä¸ªé¡¹ç›®æ·»åŠ ç¬¬ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½, "
echo "  åº”è¯¥ä»ä»€ä¹ˆåŠŸèƒ½å¼€å§‹æ¯”è¾ƒåˆé€‚ï¼Ÿ"

exit 0